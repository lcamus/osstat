---
title: "K-means clustering on aggregated datasets"
output: html_notebook
editor_options: 
  chunk_output_type: inline
---

```{r}
f <- "../data/os-aggregates_2017-10-02-2018-04-09.RData"
if(!exists("ag")) load(f)
rm(f)
```
```{r}
wssplot <- function(data, nc=15, seed=1234){
  wss <- (nrow(data)-1)*sum(apply(data,2,var))
  for (i in 2:nc){
    set.seed(seed)
    wss[i] <- sum(kmeans(data, centers=i)$withinss)}
  plot(1:nc, wss, type="b", xlab="Number of Clusters",
       ylab="Within groups sum of squares")}
```

```{r}
g <- ag[["VisitFrequency"]][["get"]]
rownames(g) <- 1:nrow(g)

g0 <- g[,which(sapply(names(g),function(x) is.numeric(g[,x])))] #filter on numeric variables
g0 <- g0[,which(!names(g0) %in% "nb_users_returning")] #useless variable
g0 <- scale(g0)

```

```{r}
#clustering K-Means
wssplot(g0, nc=6)
```

```{r}
k <- kmeans(g0,2) #k=2
# k <- kmeans(g0,3) #k=3
```

```{r}
require(cluster)
clusplot(g0, k$cluster, main='2D representation of the Cluster solution',
         color=TRUE, shade=TRUE,
         labels=2, lines=0)
```

```{r}
g <- ag[["VisitTime"]][["getByDayOfWeek"]]
g <- na.omit(g)
g <- g[-c(8,9,89),] #outliers
rownames(g) <- 1:nrow(g)

g0 <- g[,which(sapply(names(g),function(x) is.numeric(g[,x])))] #filter on numeric variables
g0 <- g0[,which(!names(g0) %in% "nb_users")] #useless variable
g0 <- scale(g0)

```

```{r}
#clustering K-Means
wssplot(g0, nc=6)
```

```{r}
k <- kmeans(g0,2) #k=2
# k <- kmeans(g0,3) #k=3
```

```{r}
clusplot(g0, k$cluster, main='2D representation of the Cluster solution',
         color=TRUE, shade=TRUE,
         labels=2, lines=0)
```

```{r}
g <- ag[["VisitsSummary"]][["get"]]
# g <- na.omit(g)
g <- g[-c(8,9,89,44),] #outliers
rownames(g) <- 1:nrow(g)

g0 <- g[,which(sapply(names(g),function(x) is.numeric(g[,x])))] #filter on numeric variables
g0 <- g0[,which(!names(g0) %in% "nb_users")] #useless variable
g0 <- scale(g0)

```

```{r}
#clustering K-Means
wssplot(g0, nc=6)
```

```{r}
k <- kmeans(g0,2)
```

```{r}
clusplot(g0, k$cluster, main='2D representation of the Cluster solution',
         color=TRUE, shade=TRUE,
         labels=2, lines=0)
```