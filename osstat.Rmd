---
title: "osstat"
output: 
  flexdashboard::flex_dashboard:
    orientation: rows
---

```{r setup, include=FALSE}
library(flexdashboard)
library(scatterD3)
load("data/d.RData")
```


Row
-----------------------------------------------------------------------


### Countries

```{r}
data <- d[["UserCountry"]][["getCountry"]]
value <- length(unique(data$metadata_code))
valueBox(value, icon = "fa-globe")

```

### Visits

```{r}
value <- paste0(round(sum(as.numeric(data$nb_visits))/1000)," k")
valueBox(value, icon = "fa-users")
```

### Actions

```{r}
value <- paste0(round(sum(as.numeric(data$nb_actions))/1000)," k")
valueBox(value, icon = "fa-dot-circle-o")
```

### Days of traffic

```{r}
value <- max(unique(data$date))-min(unique(data$date))
valueBox(value, icon = "fa-calendar")
```

Row
-----------------------------------------------------------------------

### Traffic by Country

```{r}
df<-setNames(aggregate(cbind(as.numeric(nb_visits), as.numeric(nb_actions))~metadata_code,data=d[["UserCountry"]][["getCountry"]], sum),c("country","nb_visits","nb_actions"))
df$class_visits <- with(df, ifelse(nb_visits<100, "<100",ifelse(nb_visits>500,">500","100..500")))
#par(mar = rep(4.5, 4))
#plot(data$nb_visits,data$nb_actions,main="total traffic by country",xlab="nb visits",ylab="nb actions",col="blue",pch=19)
scatterD3(data=df, x=nb_visits, y=nb_actions, point_opacity=0.5, col_var=class_visits, hover_size=4, hover_opacity=1, lab=country,
          xlab="nb visits", ylab="nb actions", col_lab="nb visits")
#data<-data[data$nb_visits>100,]
#text(data$nb_visits,data$nb_actions,labels=data$country,pos=3)
```


